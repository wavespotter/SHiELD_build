#!/bin/bash
#
# Note: Provided by: (7/12/24)
#       https://github.com/JosephMouallem/SHiELD_build/blob/main/Build/BUILDmom6
#
#***********************************************************************
#*                   GNU Lesser General Public License
#*
#* This file is part of the SHiELD Build System.
#*
#* The SHiELD Build System free software: you can redistribute it
#* and/or modify it under the terms of the
#* GNU Lesser General Public License as published by the
#* Free Software Foundation, either version 3 of the License, or
#* (at your option) any later version.
#*
#* The SHiELD Build System distributed in the hope that it will be
#* useful, but WITHOUT ANY WARRANTY; without even the implied warranty
#* of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
#* See the GNU General Public License for more details.
#*
#* You should have received a copy of the GNU Lesser General Public
#* License along with theSHiELD Build System
#* If not, see <http://www.gnu.org/licenses/>.
#***********************************************************************
#
#  DISCLAIMER: This script is provided as-is and as such is unsupported.
#
set -xe

pushd mom6

make -j8 REPRO=Y OPENMP=Y AVX=Y NETCDF=3 Makefile libmom6.a >& Build_mom6.out || cat Build_mom6.out

################
# will get noise with openmp in debugmode
################

if [ -z ${BUILD_ROOT} ] ; then
   export BUILD_ROOT=${PWD%/*}
fi

# test and report on MOM6 build success
if [ ! -f ${BUILD_ROOT}/Build/mom6/libmom6.a ] ; then
    echo ">>> ${BUILD_ROOT}/Build/mom6 build failed"
    exit 1
else
    echo " libmom6 build successful"
fi

popd
